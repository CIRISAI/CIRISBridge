# PostgreSQL Host-Based Authentication
# Active/Active Bi-Directional Replication Configuration
# Auto-generated by Ansible for {{ node_name }} node

# TYPE  DATABASE        USER            ADDRESS                 METHOD

# =============================================================================
# Local connections
# =============================================================================
local   all             all                                     trust
host    all             all             127.0.0.1/32            scram-sha-256
host    all             all             ::1/128                 scram-sha-256

# =============================================================================
# Docker network (internal services)
# =============================================================================
host    all             all             172.16.0.0/12           scram-sha-256

# =============================================================================
# Bi-Directional Logical Replication (Active/Active)
# Both nodes can replicate to/from each other
# =============================================================================
# US node (Vultr)
host    all             replicator      {{ us_ip }}/32          scram-sha-256
host    replication     replicator      {{ us_ip }}/32          scram-sha-256

# EU node (Hetzner)
host    all             replicator      {{ eu_ip }}/32          scram-sha-256
host    replication     replicator      {{ eu_ip }}/32          scram-sha-256

# =============================================================================
# Application connections
# =============================================================================
host    ciris_billing   billing_admin   172.16.0.0/12           scram-sha-256
host    ciris_billing   billing_app     172.16.0.0/12           scram-sha-256
