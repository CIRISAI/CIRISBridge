# CIRISDNS Zone Records - Active/Active GeoDNS
# Auto-generated by Ansible
#
# GeoDNS routes users to nearest active node:
# - Americas, Oceania -> US node (Vultr)
# - Europe, Africa, Asia -> EU node (Hetzner)
#
# Service endpoints:
# - billing1.ciris-services-*.ai → CIRISBilling (credit checks, charges)
# - proxy1.ciris-services-*.ai   → CIRISProxy (LLM requests)
# - agents.ciris-services-*.ai   → CIRISLens (logging)

zones:
  {{ primary_domain }}:
    # ==========================================================================
    # Root domain - GeoDNS routing
    # ==========================================================================
    - name: "@"
      type: A
      geo:
        NA: "{{ us_ip }}"  # North America -> US
        SA: "{{ us_ip }}"  # South America -> US
        OC: "{{ us_ip }}"  # Oceania -> US
        EU: "{{ eu_ip }}"  # Europe -> EU
        AF: "{{ eu_ip }}"  # Africa -> EU
        AS: "{{ eu_ip }}"  # Asia -> EU
        default: "{{ us_ip }}"
      ttl: 60
      health_check:
        us: "https://{{ us_ip }}/health"
        eu: "https://{{ eu_ip }}/health"

    # ==========================================================================
    # CIRISBilling API - GeoDNS routing
    # Used by CIRISProxy for credit checks and charges
    # ==========================================================================
    - name: billing1
      type: A
      geo:
        NA: "{{ us_ip }}"
        SA: "{{ us_ip }}"
        OC: "{{ us_ip }}"
        EU: "{{ eu_ip }}"
        AF: "{{ eu_ip }}"
        AS: "{{ eu_ip }}"
        default: "{{ us_ip }}"
      ttl: 60
      health_check:
        us: "https://billing1.{{ primary_domain }}/health"
        eu: "https://billing1.{{ secondary_domain }}/health"

    # Alias for billing.ciris.ai (referenced in callback code)
    - name: billing
      type: CNAME
      value: "billing1.{{ primary_domain }}"
      ttl: 300

    # Direct regional endpoints (bypass GeoDNS for debugging/testing)
    - name: billing-us
      type: A
      value: "{{ us_ip }}"
      ttl: 300

    - name: billing-eu
      type: A
      value: "{{ eu_ip }}"
      ttl: 300

    # ==========================================================================
    # CIRISProxy - GeoDNS routing
    # LLM proxy with billing callbacks
    # ==========================================================================
    - name: proxy1
      type: A
      geo:
        NA: "{{ us_ip }}"
        SA: "{{ us_ip }}"
        OC: "{{ us_ip }}"
        EU: "{{ eu_ip }}"
        AF: "{{ eu_ip }}"
        AS: "{{ eu_ip }}"
        default: "{{ us_ip }}"
      ttl: 60
      health_check:
        us: "https://proxy1.{{ primary_domain }}/health"
        eu: "https://proxy1.{{ secondary_domain }}/health"

    # Alias for llm.ciris.ai (user-friendly endpoint)
    - name: llm
      type: CNAME
      value: "proxy1.{{ primary_domain }}"
      ttl: 300

    # Direct regional endpoints
    - name: proxy-us
      type: A
      value: "{{ us_ip }}"
      ttl: 300

    - name: proxy-eu
      type: A
      value: "{{ eu_ip }}"
      ttl: 300

    # ==========================================================================
    # CIRISLens - Observability (US node only - centralized)
    # ==========================================================================
    - name: lens
      type: A
      value: "{{ us_ip }}"  # Always US - centralized observability
      ttl: 300

    # ==========================================================================
    # Agents endpoint (for CIRIS agents telemetry)
    # ==========================================================================
    - name: agents
      type: A
      geo:
        NA: "{{ us_ip }}"
        SA: "{{ us_ip }}"
        OC: "{{ us_ip }}"
        EU: "{{ eu_ip }}"
        AF: "{{ eu_ip }}"
        AS: "{{ eu_ip }}"
        default: "{{ us_ip }}"
      ttl: 60

    # ==========================================================================
    # Nameservers (both authoritative)
    # ==========================================================================
    - name: ns1
      type: A
      value: "{{ us_ip }}"
      ttl: 3600

    - name: ns2
      type: A
      value: "{{ eu_ip }}"
      ttl: 3600

  {{ secondary_domain }}:
    # ==========================================================================
    # Secondary domain - mirrors primary with GeoDNS
    # ==========================================================================
    - name: "@"
      type: A
      geo:
        NA: "{{ us_ip }}"
        SA: "{{ us_ip }}"
        OC: "{{ us_ip }}"
        EU: "{{ eu_ip }}"
        AF: "{{ eu_ip }}"
        AS: "{{ eu_ip }}"
        default: "{{ eu_ip }}"
      ttl: 60

    - name: billing1
      type: A
      geo:
        NA: "{{ us_ip }}"
        SA: "{{ us_ip }}"
        OC: "{{ us_ip }}"
        EU: "{{ eu_ip }}"
        AF: "{{ eu_ip }}"
        AS: "{{ eu_ip }}"
        default: "{{ eu_ip }}"
      ttl: 60

    - name: billing
      type: CNAME
      value: "billing1.{{ secondary_domain }}"
      ttl: 300

    - name: billing-us
      type: A
      value: "{{ us_ip }}"
      ttl: 300

    - name: billing-eu
      type: A
      value: "{{ eu_ip }}"
      ttl: 300

    - name: proxy1
      type: A
      geo:
        NA: "{{ us_ip }}"
        SA: "{{ us_ip }}"
        OC: "{{ us_ip }}"
        EU: "{{ eu_ip }}"
        AF: "{{ eu_ip }}"
        AS: "{{ eu_ip }}"
        default: "{{ eu_ip }}"
      ttl: 60

    - name: llm
      type: CNAME
      value: "proxy1.{{ secondary_domain }}"
      ttl: 300

    - name: proxy-us
      type: A
      value: "{{ us_ip }}"
      ttl: 300

    - name: proxy-eu
      type: A
      value: "{{ eu_ip }}"
      ttl: 300

    - name: lens
      type: A
      value: "{{ us_ip }}"  # Always US - centralized observability
      ttl: 300

    - name: agents
      type: A
      geo:
        NA: "{{ us_ip }}"
        SA: "{{ us_ip }}"
        OC: "{{ us_ip }}"
        EU: "{{ eu_ip }}"
        AF: "{{ eu_ip }}"
        AS: "{{ eu_ip }}"
        default: "{{ eu_ip }}"
      ttl: 60

    - name: ns1
      type: A
      value: "{{ us_ip }}"
      ttl: 3600

    - name: ns2
      type: A
      value: "{{ eu_ip }}"
      ttl: 3600
