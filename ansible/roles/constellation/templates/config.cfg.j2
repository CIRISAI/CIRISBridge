# Constellation DNS Server Configuration
# Active/Active with GeoDNS Routing
# Auto-generated by Ansible for {{ node_name }} node

[server]
dns_inet = "0.0.0.0:53"
http_inet = "0.0.0.0:8080"
log_level = "info"

[dns]
zone_authoritative = [
    "{{ primary_domain }}",
    "{{ secondary_domain }}"
]

record_ttl_default = 60
soa_ttl = 3600

soa_primary_server = "ns1.{{ dns_soa }}"
soa_admin_email = "{{ admin_email | default('admin') | replace('@', '.') }}.{{ dns_soa }}"
soa_serial = 1
soa_refresh = 3600
soa_retry = 600
soa_expire = 86400
soa_minimum = 60

[redis]
host = "redis"
port = 6379
database = 0
pool_size = 4

# =============================================================================
# Geographic Routing Configuration
# =============================================================================
[geo]
enabled = true
database_path = "/data/GeoLite2-Country.mmdb"

# Default to local node if geo lookup fails
default_region = "{{ node_name }}"

# =============================================================================
# Health Checks for Active/Active Failover
# =============================================================================
[health]
enabled = true
check_interval_seconds = 30
check_timeout_seconds = 5
unhealthy_threshold = 3
healthy_threshold = 2

# Health endpoints for both nodes
[[health.targets]]
name = "us_node"
url = "http://{{ us_ip }}:8080/health"
region = "us"

[[health.targets]]
name = "eu_node"
url = "http://{{ eu_ip }}:8080/health"
region = "eu"

# =============================================================================
# HTTP API Configuration
# =============================================================================
[http]
{% if constellation_api_token is defined %}
auth_token = "{{ constellation_api_token }}"
{% endif %}
cors_allow_origin = ""
